<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.koreait.shopping.user.UserMapper">

    <insert id="insUser">
        INSERT INTO t_user
        (
             uid, upw, nm, firsthnum, secondhnum, thirdhnum, firstph
            , secondph, thirdph, social, post_num, load_nm, lot_addr
            , detail_addr, ref, gender, email, birth, location, recommendation
            , email_agree_flag, sms_agree_flag
        )
        VALUES
        (
             #{uid}, #{upw}, #{nm}, #{firsthnum}, #{secondhnum}, #{thirdhnum}
             , #{firstph}, #{secondph}, #{thirdph}, #{social}, #{post_num}, #{load_nm}
             , #{lot_addr} , #{detail_addr}, #{ref}, ${gender}, #{email}, #{birth}
             , #{location}, #{recommendation}, #{email_agree_flag}, #{sms_agree_flag}
         )
    </insert>

    <insert id="insReview">
        INSERT INTO t_user_review
        (
            iboard, iuser, rating, answer0, answer1, answer2, answer3, gender, tall
        , weight, title,ctnt, prom_agree_flag, inf_agree_flag
        )
        VALUES
        (
            ${iboard}, ${iuser}, ${rating}, ${answer0}, ${answer1}, ${answer2}, ${answer3}
            , ${gender}, #{tall}, #{weight}, #{title}, #{ctnt}, ${prom_agree_flag}, ${inf_agree_flag}
        )
    </insert>

    <select id="selUser" resultType="UserEntity">
        SELECT * FROM t_user
        WHERE
        <if test=" uid != null and uid != '' "> uid = #{uid} </if>
        <if test=" iuser > 0 "> iuser = ${iuser} </if>
        <if test=" email != null and email != '' "> email = #{email} </if>
    </select>

    <select id="selMdUser" resultType="UserEntity">
        SELECT * FROM t_user
        WHERE
        <if test=" iuser > 0 "> iuser = ${iuser} </if>
    </select>

    <select id="selSocial" resultType="UserEntity">
        SELECT * FROM t_user
        WHERE email = #{email}
    </select>

    <update id="updUserPw">
        UPDATE t_user
        SET
        <if test=" upw != null and upw != '' ">
            upw = #{upw}
        </if>
        WHERE iuser = ${iuser}
    </update>

    <select id="checkedCart" resultType="BoardProductVo">
        SELECT A.sm, A.md, A.lg, A.xl, A.color, A.iboard, A.icart, A.checked, B.iuser, C.img_url_big, C.title, C.price
        FROM cart A
        INNER JOIN t_user B
        ON A.iuser = B.iuser
        INNER JOIN product_list C
        ON A.iboard = C.iboard
        WHERE B.iuser = ${iuser} AND A.checked = 1
    </select>

    <update id="updProductDetail">
        UPDATE product_detail
        <if test=" sm != null and sm !=0 ">SET sm = sm - ${sm}</if>
        <if test=" md != null and md !=0 ">SET md = md - ${md}</if>
        <if test=" lg != null and lg !=0 ">SET lg = lg - ${lg}</if>
        <if test=" xl != null and xl !=0 ">SET xl = xl - ${xl}</if>
        WHERE iboard = ${iboard} AND color = ${color}
    </update>

</mapper>